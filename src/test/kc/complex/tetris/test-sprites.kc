import "tetris-sprites"

byte* SIN = $1400;

byte* SIN_SPRITE = $2800;

kickasm(pc SIN) {{
    .var AMPL = 200-21
    .for(var i=0; i<256; i++) {
  	  .byte 51+AMPL/2+sin(toRadians([i*360]/256))*AMPL/2
    }
}}

kickasm(pc SIN_SPRITE) {{
    .fill $40, $ff
}}

byte sin_idx = 0;

void main() {
	vicSelectGfxBank(PLAYFIELD_SCREEN_1);
	*D018 = toD018(PLAYFIELD_SCREEN_1, PLAYFIELD_CHARSET);
	sprites_init();

	*SPRITES_ENABLE = $ff;

    byte xpos = 24;
    byte ypos = 50;
    for(byte s:4..7) {
    	byte s2 = s*2;
		SPRITES_XPOS[s2] = xpos;
		SPRITES_YPOS[s2] = ypos;
		SPRITES_COLS[s] = s-3;
		PLAYFIELD_SPRITE_PTRS_1[s] = toSpritePtr(SIN_SPRITE);
		xpos +=  24;
		ypos +=  24;
    }

    sprites_irq_init();
    loop();
}


void loop() {
    while(true) {
        do {} while (*RASTER!=$ff);
        byte idx = sin_idx;
        for(byte s:4..7) {
    		SPRITES_YPOS[s*2] = SIN[idx];
    		idx += 10;
        }
        sin_idx++;

    }
}
