// Tetris Game Implementation
import "c64"
import "memory"
import "keyboard"
import "sid"
import "tetris-data"
import "tetris-render"
import "tetris-sprites"
import "tetris-play"

void main() {
	sid_rnd_init();
	asm { sei }
	render_init();
	sprites_init();
	sprites_irq_init();
	play_init();
	play_spawn_current();
	render_playfield();
	render_current();
	while(true) { 
		// Wait for a frame to pass
		while(*RASTER!=$ff) {}
		while(*RASTER!=$fe) {}
		(*BORDERCOL)++;
		// Scan keyboard events
		keyboard_event_scan();
		byte key_event = keyboard_event_get();
		byte render = 0;
		render += play_move_down(key_event);
		render += play_move_leftright(key_event);
		render += play_move_rotate(key_event);
		if(render!=0) {
			render_playfield();
			render_current();
		}
		(*BORDERCOL)--;			
	}
}
