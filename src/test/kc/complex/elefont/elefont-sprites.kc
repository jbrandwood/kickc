// Put a 2x2 font into sprites and show on screen

import "c64"

char * const CHARSET_DEFAULT = 0x1000;
char * const ELEFONT = 0x2000;
char * const SPRITES = 0x3000;
char * const SCREEN =  0x0400;
char * const SCREEN_SPRITES = SCREEN + SPRITE_PTRS;


kickasm(pc ELEFONT, resource "elefont.bin") {{
	.import binary "elefont.bin"
}}

void main() {
    *D018 = toD018(SCREEN, CHARSET_DEFAULT);
    font_2x2_to_sprites(ELEFONT, SPRITES, 64);
	*SPRITES_ENABLE = 1;
    SPRITES_XPOS[0] = 100;
	SPRITES_YPOS[0] = 100;
	SPRITES_COLS[0] = WHITE;
	SCREEN_SPRITES[0] = toSpritePtr(SPRITES)+1;
}

// Convert a 2x2-font to sprites
// - font_2x2 The source 2x2-font
// - sprites The destination sprites
// - num_chars The number of chars to convert
void font_2x2_to_sprites(char* font_2x2, char* sprites, char num_chars) {
    char * char_current = font_2x2;
    char * sprite = sprites;
    for(char c=0;c<num_chars;c++) {
        // Upper char
        char * char_left = char_current;
        char * char_right = char_current + 0x40*8;
        char sprite_idx = 0;
        for(char i: 0..20) {
            sprite[sprite_idx++] = char_left[i&7];
            sprite[sprite_idx++] = char_right[i&7];
            sprite[sprite_idx++] = 0x00;
            if(i==7) {
                // Lower char
                char_left = char_current + 0x80*8;
                char_right = char_current + 0xc0*8;
            } else if(i==15) {
                // Empty char
                char_left = font_2x2+' '*8;
                char_right = font_2x2+' '*8;
            }
        }
        char_current += 8;
        sprite += 0x40;
    }
}
