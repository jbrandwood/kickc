// XMega65 Kernal Development Template
// Each function of the kernal is a no-args function
// The functions are placed in the SYSCALLS table surrounded by JMP and NOP

#pragma link("xmega65.ld")

void main() {
    char i=0;
    // Call functions one at a time
    while(true) {
        unsigned int fn = CALLS[i*2];
        void()* f = (void()*)fn;
        (*f)();
        if(++i==2) i=0;
    }
}

void fn1() {
    const char* BORDERCOL = $d020;
    (*BORDERCOL)++;
}

void fn2() {
    const char* BGCOL = $d021;
    (*BGCOL)++;
}

#pragma data_seg(Syscall)

const char JMP = 0x4c;
const char NOP = 0xea;

char[] SYSCALLS = {
    JMP, <&fn1, >&fn1, NOP,
    JMP, <&fn2, >&fn2, NOP
    };

const unsigned int* CALLS = (unsigned int*)(SYSCALLS+1);
